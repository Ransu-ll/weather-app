<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ town_name }} - Weather Forecast</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
{% set icon_map = {
  "partly cloudy": "weather-svgrepo-com (1).svg",
  "cloudy": "weather-svgrepo-com (1).svg",
  "mostly sunny": "weather-symbol-1-svgrepo-com.svg",
  "sunny": "weather-symbol-1-svgrepo-com.svg",
  "clear": "weather-symbol-1-svgrepo-com.svg",
  "shower": "weather-rain-svgrepo-com.svg",
  "rain": "weather-rain-svgrepo-com.svg",
  "wind": "weather-windy-svgrepo-com.svg",
  "thunder": "weather-2-svgrepo-com.svg",
  "storm": "weather-2-svgrepo-com.svg",
  "snow": "weather-symbol-18-svgrepo-com.svg",
  "fog": "weather-symbol-22-svgrepo-com.svg",
  "mist": "weather-symbol-7-svgrepo-com.svg",
  "night": "weather-color-moon-stars-svgrepo-com.svg",
  "default": "weather-svgrepo-com.svg"
} %}

<div class="weather-container">
  <!-- LEFT MAIN CARD -->
  <div class="main-card">
    <div class="top">
      <h2>{{ town_name }}</h2>
      <p>{{ (town_data.keys()|list)[0] }}</p>
    </div>

    {% set first_day = town_data[(town_data.keys()|list)[0]] %}
    {% set precis_clean = first_day['precis']|lower|replace('.', '')|trim %}
    {% set icon_file = icon_map['default'] %}
    {% if 'rain' in precis_clean or 'shower' in precis_clean %}
      {% set icon_file = icon_map['rain'] %}
    {% elif 'cloud' in precis_clean %}
      {% set icon_file = icon_map['cloudy'] %}
    {% elif 'sunny' in precis_clean or 'mostly sunny' in precis_clean %}
      {% set icon_file = icon_map['sunny'] %}
    {% elif 'clear' in precis_clean %}
      {% set icon_file = icon_map['clear'] %}
    {% elif 'fog' in precis_clean or 'mist' in precis_clean %}
      {% set icon_file = icon_map['fog'] %}
    {% elif 'snow' in precis_clean %}
      {% set icon_file = icon_map['snow'] %}
    {% elif 'thunder' in precis_clean or 'storm' in precis_clean %}
      {% set icon_file = icon_map['thunder'] %}
    {% endif %}

    <div class="center">
      <img class="main-icon" src="{{ url_for('static', filename='icons/' + icon_file) }}" alt="{{ first_day['precis'] }}">
      <div class="temp">
        {% if 'air_temperature_minimum' in first_day %}
          {{ first_day['air_temperature_minimum'] }}Â° â€“ 
        {% endif %}
        {% if 'air_temperature_maximum' in first_day %}
          {{ first_day['air_temperature_maximum'] }}Â°
        {% endif %}
      </div>
      <div class="condition">{{ first_day['precis'] }}</div>
      <div class="metrics">
        {% if 'probability_of_precipitation' in first_day %}
          <p>ðŸ’§ Chance of rain: {{ first_day['probability_of_precipitation'] }}</p>
        {% endif %}
        {% if 'precipitation_range' in first_day %}
          <p>ðŸŒ§ Rainfall: {{ first_day['precipitation_range'] }}</p>
        {% endif %}
      </div>
    </div>

    <!-- 7-DAY FORECAST -->
    <div class="forecast">
      {% for date, details in town_data.items() %}
        {% set precis_clean = details['precis']|lower|replace('.', '')|trim %}
        {% set icon_file = icon_map['default'] %}
        {% if 'rain' in precis_clean or 'shower' in precis_clean %}
          {% set icon_file = icon_map['rain'] %}
        {% elif 'cloud' in precis_clean %}
          {% set icon_file = icon_map['cloudy'] %}
        {% elif 'sunny' in precis_clean or 'mostly sunny' in precis_clean %}
          {% set icon_file = icon_map['sunny'] %}
        {% elif 'clear' in precis_clean %}
          {% set icon_file = icon_map['clear'] %}
        {% elif 'fog' in precis_clean or 'mist' in precis_clean %}
          {% set icon_file = icon_map['fog'] %}
        {% elif 'snow' in precis_clean %}
          {% set icon_file = icon_map['snow'] %}
        {% elif 'thunder' in precis_clean or 'storm' in precis_clean %}
          {% set icon_file = icon_map['thunder'] %}
        {% endif %}

        <div class="day">
          <p class="forecast-date">{{ date }}</p>
          <img class="forecast-icon"
               src="{{ url_for('static', filename='icons/' + icon_file) }}"
               alt="{{ details['precis'] }}">
          <p class="condition"><strong>{{ details['precis'] }}</strong></p>
          {% if 'air_temperature_minimum' in details %}
            <p>Min: {{ details['air_temperature_minimum'] }} Â°C</p>
          {% endif %}
          {% if 'air_temperature_maximum' in details %}
            <p>Max: {{ details['air_temperature_maximum'] }} Â°C</p>
          {% endif %}
          {% if 'probability_of_precipitation' in details %}
            <p>Chance of rain: {{ details['probability_of_precipitation'] }}</p>
          {% endif %}
          {% if 'precipitation_range' in details %}
            <p>Potential rainfall: {{ details['precipitation_range'] }}</p>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  </div>

  <!-- RIGHT SIDEBAR -->
  <div class="sidebar">
    {% set hour = current_time.hour %}
    <h3>
      Good {% if hour < 12 %}Morning{% elif hour < 18 %}Afternoon{% else %}Evening{% endif %}
    </h3>
    <p class="time">{{ current_time.strftime('%I:%M %p') }}</p>

    {% set precis_clean = first_day['precis']|lower|replace('.', '')|trim %}
    {% set icon_file = icon_map['default'] %}
    {% if 'rain' in precis_clean or 'shower' in precis_clean %}
      {% set icon_file = icon_map['rain'] %}
    {% elif 'cloud' in precis_clean %}
      {% set icon_file = icon_map['cloudy'] %}
    {% elif 'sunny' in precis_clean or 'mostly sunny' in precis_clean %}
      {% set icon_file = icon_map['sunny'] %}
    {% elif 'fog' in precis_clean or 'mist' in precis_clean %}
      {% set icon_file = icon_map['fog'] %}
    {% elif 'thunder' in precis_clean or 'storm' in precis_clean %}
      {% set icon_file = icon_map['thunder'] %}
    {% endif %}

    <div class="mini-card">
      <img src="{{ url_for('static', filename='icons/' + icon_file) }}" alt="{{ first_day['precis'] }}">
      <p>
        {% if 'air_temperature_minimum' in first_day %}
          {{ first_day['air_temperature_minimum'] }}Â° â€“
        {% endif %}
        {% if 'air_temperature_maximum' in first_day %}
          {{ first_day['air_temperature_maximum'] }}Â°
        {% endif %} | {{ first_day['precis'] }}
      </p>
    </div>

    <h4>Next Forecasts</h4>
    <div class="hourly">
      {% set limited_forecast = town_data.items()|list %}
      {% for date, details in limited_forecast[:4] %}
        {% set precis_clean = details['precis']|lower|replace('.', '')|trim %}
        {% set icon_file = icon_map['default'] %}
        {% if 'rain' in precis_clean or 'shower' in precis_clean %}
          {% set icon_file = icon_map['rain'] %}
        {% elif 'cloud' in precis_clean %}
          {% set icon_file = icon_map['cloudy'] %}
        {% elif 'sunny' in precis_clean or 'mostly sunny' in precis_clean %}
          {% set icon_file = icon_map['sunny'] %}
        {% elif 'thunder' in precis_clean or 'storm' in precis_clean %}
          {% set icon_file = icon_map['thunder'] %}
        {% elif 'fog' in precis_clean or 'mist' in precis_clean %}
          {% set icon_file = icon_map['fog'] %}
        {% endif %}
        <div class="hour">
          <img src="{{ url_for('static', filename='icons/' + icon_file) }}" alt="{{ details['precis'] }}">
          <p class="hour-date">{{ date[-5:] }}</p>
          {% if 'air_temperature_maximum' in details %}
            <p>{{ details['air_temperature_maximum'] }}Â°</p>
          {% endif %}
          <p class="hour-condition">{{ details['precis'] }}</p>
        </div>
      {% endfor %}
    </div>
  </div>
</div>
</body>
</html>
